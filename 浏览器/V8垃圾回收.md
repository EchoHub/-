# V8 垃圾回收

### 垃圾回收 
垃圾回收（简称 GC）：是一种自动内存管理机制，用于标记和清除不再被使用的对象或数据。当一个对象不再被使用时，垃圾回收器会将其标记为垃圾进行回收，并释放内存供其他对象使用；垃圾回收机制可减少内存泄漏且提升CPU性能。

### 常用的垃圾回收算法
- 引用计数算法：通过跟踪每个对象的引用次数，对引用次数为0的对象进行实时回收。
    - 优点：1）实时回收；
    - 缺点：1）无法清除循环引用的对象；2）需要消耗额外的内存记录对象的引用次数，会存在额外的损耗

- 标记清除算法：通过标记不再被使用的对象或数据进行清除。
    - 原理：垃圾回收器从根对象，根据依赖关系遍历所有的活动对象，对可访问到的对象标记可达，对不可访问到的对象标记不可达；遍历完成之后，垃圾回收器会对所有标记不可达的对象进行回收。
    - 优点：1）可识别循环引用的对象进行清除作业
    - 缺点：1）回收时会中断程序的运行；2）会导致内存碎片化现象

- 标记-整理-清除算法：在标记清除算法的基础上对内存进行整理，以解决内存碎片化问题
    - 原理：垃圾回收器从根对象，根据依赖关系遍历所有对象，对可访问对象标记可达，对不可访问对象标记不可达；将所有标记可达的对象移动到空间的一边，以整理出连续的内存空间；将所有标记不可达的对象进行回收
    - 优点：1）可识别循环引用对象并进行清除；2）解决内存碎片化问题
    - 缺点：1）回收时会中断程序的运行

### V8引擎
V8引擎是一套解析javascript的开源引擎，可用于浏览器和node.js；V8引擎通过将javascript转换为计算机机器码，从而提升javascript的运行效率

### V8垃圾回收机制
V8垃圾回收采用分代式垃圾回收策略，即根据活动对象的存活时间分为新生代、老生代；针对不同代采用不同的垃圾回收策略。
- 新生代：V8引擎采用副垃圾回收器对新生代进行垃圾回收处理，对新生代内存空间开辟为两个同样大小的空间：From空间、To空间；初始化阶段活动对象存在From空间内，当进入回收阶段时，垃圾回收器会从根对象开始根据依赖关系遍历所有的活动对象，对可访问的对象标记可达，对所有不可访问的对象标记不可达；遍历完成之后，垃圾回收器会将所有标记可达的对象从From空间中复制到To空间内；复制完成后，会对From空间进行清除操作；操作完成之后，再将To空间与From空间角色对换，等待下一次的GC。
- 新生代晋升老生代的条件
    - 每个新生代对象都有一个记录器，用来记录该对象经历GC的次数；当该对象的记录数超过设定的阈值时，则会将新生代晋升为老生代；
    - 当TO空间的内存空间超过一定比例（一般为25% ～ 50%）时，则会将To空间内的所有活动对象晋升为老生代。
- 老生代：V8引擎采用主垃圾回收器对老生代进行垃圾回收处理，通过标记-整理-清除算法对老生代进行标记清除，以及内存整理

### V8回收优化
- 并行回收机制

- 增量标记